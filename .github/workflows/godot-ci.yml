name: "godot-ci export"

env:
    GODOT_VERSION: 3.4.2
    EXPORT_NAME: checker
    
on:
    workflow_dispatch:
    push:
        branches:
          - main
        
jobs:
    export-windows:
        name: Windows Export
        runs-on: ubuntu-20.04
        
        container:
            image: barichello/godot-ci:3.4.2
            
        steps:
          - name: Checkout
            uses: actions/checkout@v2
            
          - name: Setup
            run: |
                mkdir -v -p ~/.local/share/godot/templates
                mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
          - name: Windows Build
            run: |
                mkdir -v -p build/windows
                godot -v --path ./project --export "Windows Desktop" ../build/windows/$EXPORT_NAME.exe
                
          - name: Upload Artifact
            uses: actions/upload-artifact@v1
            with:
                name: windows
                path: build/windows